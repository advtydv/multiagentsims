<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Batch Analysis Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <!-- Plotly for advanced visualizations -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    
    <style>
        .insight-card {
            border-left: 4px solid #007bff;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        .insight-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .insight-card.high-confidence {
            border-left-color: #28a745;
        }
        .insight-card.medium-confidence {
            border-left-color: #ffc107;
        }
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
        }
        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        .correlation-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.85rem;
        }
        .correlation-strong {
            background-color: #d4edda;
            color: #155724;
        }
        .correlation-moderate {
            background-color: #fff3cd;
            color: #856404;
        }
        .correlation-weak {
            background-color: #f8d7da;
            color: #721c24;
        }
        .strategy-card {
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .performance-tier {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        .tier-top {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .tier-middle {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .tier-bottom {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        .stat-significant {
            background-color: #e7f5ff;
            border: 1px solid #74c0fc;
            padding: 1rem;
            border-radius: 8px;
        }
    </style>
</head>
<body class="batch-mode">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-graph-up-arrow"></i> Enhanced Batch Analysis
            </a>
            <div class="navbar-nav ms-auto">
                <select id="batchSelect" class="form-select" style="width: 400px;">
                    <option value="">Select a batch simulation...</option>
                </select>
                <a href="/" class="btn btn-light ms-2">
                    <i class="bi bi-arrow-left"></i> Single Simulation
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <!-- Batch Info Header -->
        <div id="batchInfo" class="alert alert-primary d-none">
            <div class="row align-items-center">
                <div class="col-md-2">
                    <strong>Batch:</strong> <span id="batchId"></span>
                </div>
                <div class="col-md-2">
                    <strong>Simulations:</strong> <span id="numSimulations"></span>
                </div>
                <div class="col-md-2">
                    <strong>Data Points:</strong> <span id="dataPoints"></span>
                </div>
                <div class="col-md-2">
                    <strong>Confidence:</strong> <span id="confidenceLevel"></span>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-sm btn-outline-primary" onclick="exportData()">
                        <i class="bi bi-download"></i> Export Data
                    </button>
                    <button class="btn btn-sm btn-outline-primary" onclick="refreshAnalysis()">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div id="mainContent" class="d-none">
            <!-- Key Insights Summary (Always Visible) -->
            <div class="row mb-3" id="keyInsights">
                <div class="col-12">
                    <h4><i class="bi bi-lightbulb"></i> Key Insights</h4>
                    <div id="insightsContainer" class="row">
                        <!-- Insights will be dynamically added here -->
                    </div>
                </div>
            </div>

            <!-- Main Analysis Tabs -->
            <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="strategy-tab" data-bs-toggle="tab" data-bs-target="#strategy" type="button">
                        <i class="bi bi-trophy"></i> Strategy Effectiveness
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="patterns-tab" data-bs-toggle="tab" data-bs-target="#patterns" type="button">
                        <i class="bi bi-diagram-3"></i> Performance Patterns
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="economics-tab" data-bs-toggle="tab" data-bs-target="#economics" type="button">
                        <i class="bi bi-currency-exchange"></i> Information Economics
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="correlations-tab" data-bs-toggle="tab" data-bs-target="#correlations" type="button">
                        <i class="bi bi-bezier2"></i> Behavioral Correlations
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="temporal-tab" data-bs-toggle="tab" data-bs-target="#temporal" type="button">
                        <i class="bi bi-clock-history"></i> Temporal Dynamics
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="statistical-tab" data-bs-toggle="tab" data-bs-target="#statistical" type="button">
                        <i class="bi bi-calculator"></i> Statistical Analysis
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="advanced-tab" data-bs-toggle="tab" data-bs-target="#advanced" type="button">
                        <i class="bi bi-rocket"></i> Advanced Insights
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="mainTabContent">
                <!-- Strategy Effectiveness Tab -->
                <div class="tab-pane fade show active" id="strategy" role="tabpanel">
                    <div class="mt-4">
                        <div class="row">
                            <div class="col-md-8">
                                <h5>Strategy Performance Comparison</h5>
                                <div id="strategyChart"></div>
                            </div>
                            <div class="col-md-4">
                                <h5>Strategy Breakdown</h5>
                                <div id="strategyCards">
                                    <!-- Strategy cards will be dynamically added -->
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <h5>Win Rate by Strategy</h5>
                                <canvas id="winRateChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Patterns Tab -->
                <div class="tab-pane fade" id="patterns" role="tabpanel">
                    <div class="mt-4">
                        <div class="row">
                            <div class="col-12">
                                <h5>Performance Tier Analysis</h5>
                                <p class="text-muted">What differentiates top performers from others?</p>
                            </div>
                        </div>
                        <div class="row" id="performanceTiers">
                            <!-- Tier analysis cards will be added here -->
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h5>Key Differentiators</h5>
                                <canvas id="differentiatorsChart"></canvas>
                            </div>
                            <div class="col-md-6">
                                <h5>Performance Distribution</h5>
                                <div id="performanceDistribution"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Information Economics Tab -->
                <div class="tab-pane fade" id="economics" role="tabpanel">
                    <div class="mt-4">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Information Sharing ROI</h5>
                                <div id="sharingROIChart"></div>
                            </div>
                            <div class="col-md-6">
                                <h5>Optimal Sharing Rate</h5>
                                <div id="optimalSharingChart"></div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h6>Sharing Strategy</h6>
                                        <div class="metric-value" id="sharingAvgScore">-</div>
                                        <div class="metric-label">Average Score</div>
                                        <div class="mt-2">
                                            <small>ROI: <span id="sharingROI">-</span></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h6>Hoarding Strategy</h6>
                                        <div class="metric-value" id="hoardingAvgScore">-</div>
                                        <div class="metric-label">Average Score</div>
                                        <div class="mt-2">
                                            <small>Kept Info: <span id="hoardingKept">-</span></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body text-center">
                                        <h6>Optimal Range</h6>
                                        <div class="metric-value" id="optimalRange">-</div>
                                        <div class="metric-label">Share Rate</div>
                                        <div class="mt-2">
                                            <small>Peak Score: <span id="optimalScore">-</span></small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Behavioral Correlations Tab -->
                <div class="tab-pane fade" id="correlations" role="tabpanel">
                    <div class="mt-4">
                        <div class="row">
                            <div class="col-md-8">
                                <h5>Behavior-Performance Correlations</h5>
                                <div id="correlationChart"></div>
                            </div>
                            <div class="col-md-4">
                                <h5>Most Impactful Behaviors</h5>
                                <div id="impactfulBehaviors">
                                    <!-- List will be added here -->
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <h5>Correlation Matrix</h5>
                                <div id="correlationMatrix"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Temporal Dynamics Tab -->
                <div class="tab-pane fade" id="temporal" role="tabpanel">
                    <div class="mt-4">
                        <div class="row">
                            <div class="col-12">
                                <h5>Activity Over Time</h5>
                                <div id="temporalChart"></div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0">Early Game</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="earlyGameMetrics">
                                            <!-- Metrics will be added here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="mb-0">Mid Game</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="midGameMetrics">
                                            <!-- Metrics will be added here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">Late Game</h6>
                                    </div>
                                    <div class="card-body">
                                        <div id="lateGameMetrics">
                                            <!-- Metrics will be added here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <h6>Temporal Pattern: <span id="temporalPattern" class="badge bg-primary">-</span></h6>
                                    <p class="mb-0">Activity Change: <span id="activityChange">-</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Statistical Analysis Tab -->
                <div class="tab-pane fade" id="statistical" role="tabpanel">
                    <div class="mt-4">
                        <div class="row">
                            <div class="col-12">
                                <h5>Statistical Significance Tests</h5>
                                <p class="text-muted">Confidence in our findings based on statistical analysis</p>
                            </div>
                        </div>
                        <div id="statisticalTests">
                            <!-- Statistical test results will be added here -->
                        </div>
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="alert alert-warning">
                                    <i class="bi bi-info-circle"></i> <strong>Note:</strong> 
                                    Results marked as "significant" (p < 0.05) indicate strong evidence for the observed patterns.
                                    Non-significant results suggest the differences might be due to chance.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Insights Tab -->
                <div class="tab-pane fade" id="advanced" role="tabpanel">
                    <div class="mt-4">
                        <!-- Strategic Recommendations -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4><i class="bi bi-lightbulb-fill"></i> Strategic Recommendations</h4>
                                <div id="strategicRecommendations">
                                    <!-- Recommendations will be displayed here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Variance Analysis -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Outcome Stability Analysis</h5>
                                    </div>
                                    <div class="card-body" id="outcomeStability">
                                        <!-- Stability metrics will be shown here -->
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Agent Consistency Tracking</h5>
                                    </div>
                                    <div class="card-body" id="agentConsistency">
                                        <!-- Consistency data will be shown here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Agent Trajectories -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5>Agent Performance Trajectories</h5>
                                <div id="trajectoryChart"></div>
                            </div>
                        </div>
                        
                        <!-- Meta Insights -->
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header bg-info text-white">
                                        <h6 class="mb-0">Simulation Quality</h6>
                                    </div>
                                    <div class="card-body" id="simulationQuality">
                                        <!-- Quality metrics -->
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0">Strategic Diversity</h6>
                                    </div>
                                    <div class="card-body" id="strategicDiversity">
                                        <!-- Diversity metrics -->
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header bg-warning text-white">
                                        <h6 class="mb-0">Competitive Dynamics</h6>
                                    </div>
                                    <div class="card-body" id="competitiveDynamics">
                                        <!-- Competition metrics -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="d-none">
            <div class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <div class="mt-3">
                    <h5>Analyzing Batch Data...</h5>
                    <p>Processing <span id="processingCount">0</span> simulations</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS for Enhanced Batch Dashboard -->
    <script src="{{ url_for('static', filename='js/batch_enhanced.js') }}"></script>
</body>
</html>