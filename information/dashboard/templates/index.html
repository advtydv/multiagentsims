<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Information Asymmetry Simulation Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <!-- D3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-diagram-3"></i> Simulation Dashboard
            </a>
            <div class="navbar-nav ms-auto">
                <select id="simulationSelect" class="form-select" style="width: 300px;">
                    <option value="">Select a simulation...</option>
                </select>
                <a href="/batch" class="btn btn-outline-light ms-2">
                    <i class="bi bi-graph-up-arrow"></i> Enhanced Batch Analysis
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-3">
        <div id="simulationInfo" class="alert alert-info d-none">
            <div class="row">
                <div class="col-md-3">
                    <strong>Simulation:</strong> <span id="simId"></span>
                </div>
                <div class="col-md-3">
                    <strong>Agents:</strong> <span id="numAgents"></span>
                </div>
                <div class="col-md-3">
                    <strong>Rounds:</strong> <span id="numRounds"></span>
                </div>
                <div class="col-md-3">
                    <strong>Status:</strong> <span id="simStatus"></span>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div id="mainContent" class="d-none">
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="timeline-tab" data-bs-toggle="tab" data-bs-target="#timeline" type="button">
                        <i class="bi bi-clock-history"></i> Timeline View
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="network-tab" data-bs-toggle="tab" data-bs-target="#network" type="button">
                        <i class="bi bi-diagram-2"></i> Agent Network
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="tasks-tab" data-bs-toggle="tab" data-bs-target="#tasks" type="button">
                        <i class="bi bi-list-check"></i> Task Progress
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="rankings-tab" data-bs-toggle="tab" data-bs-target="#rankings" type="button">
                        <i class="bi bi-graph-up"></i> Rankings & Scores
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="analysis-tab" data-bs-toggle="tab" data-bs-target="#analysis" type="button">
                        <i class="bi bi-cpu"></i> Strategic Analysis
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="quantitative-tab" data-bs-toggle="tab" data-bs-target="#quantitative" type="button">
                        <i class="bi bi-bar-chart"></i> Quantitative Analysis
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports" type="button">
                        <i class="bi bi-file-text"></i> Strategic Reports
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="cooperation-tab" data-bs-toggle="tab" data-bs-target="#cooperation" type="button">
                        <i class="bi bi-people"></i> Cooperation Analysis
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="information-tab" data-bs-toggle="tab" data-bs-target="#information" type="button">
                        <i class="bi bi-info-square"></i> Information Value
                    </button>
                </li>
            </ul>

            <!-- Tab content -->
            <div class="tab-content" id="mainTabContent">
                <!-- Timeline View -->
                <div class="tab-pane fade show active" id="timeline" role="tabpanel">
                    <div class="row mt-3">
                        <div class="col-md-3">
                            <!-- Filters Panel -->
                            <div class="card">
                                <div class="card-header">
                                    <h5>Filters</h5>
                                </div>
                                <div class="card-body">
                                    <h6>Event Types</h6>
                                    <div id="eventTypeFilters" class="mb-3">
                                        <!-- Event type checkboxes will be added here -->
                                    </div>
                                    
                                    <h6>Agents</h6>
                                    <div id="agentFilters" class="mb-3">
                                        <!-- Agent checkboxes will be added here -->
                                    </div>
                                    
                                    <small class="text-muted">Filters apply automatically</small>
                                </div>
                            </div>
                            
                            <!-- Agent Legend -->
                            <div class="card mt-3">
                                <div class="card-header">
                                    <h5>Agent Colors</h5>
                                </div>
                                <div class="card-body" id="agentLegend">
                                    <!-- Agent color legend will be added here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-9">
                            <!-- Round Navigation -->
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <button class="btn btn-primary" onclick="previousRound()">
                                    <i class="bi bi-chevron-left"></i> Previous Round
                                </button>
                                <h4 id="currentRoundDisplay">Round 1</h4>
                                <button class="btn btn-primary" onclick="nextRound()">
                                    Next Round <i class="bi bi-chevron-right"></i>
                                </button>
                            </div>
                            
                            <!-- Timeline Content -->
                            <div id="timelineContent">
                                <!-- Round events will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agent Network -->
                <div class="tab-pane fade" id="network" role="tabpanel">
                    <div class="mt-3">
                        <!-- Network Overview -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Agent Communication Network</h4>
                                <p class="text-muted">Visual representation of communication patterns and information flow</p>
                            </div>
                        </div>
                        
                        <!-- Information Flow Metrics -->
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body" id="infoVelocity">
                                        <!-- Information velocity chart will be rendered here -->
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body" id="requestFulfillment">
                                        <!-- Request fulfillment ratio chart will be rendered here -->
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-body" id="infoDistribution">
                                        <!-- Information distribution metrics will be rendered here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Information Exchange Matrix -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body" id="infoExchangeMatrix">
                                        <!-- Information exchange matrix will be rendered here -->
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body" id="agentPerformance">
                                        <!-- Agent performance table will be rendered here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Task Progress -->
                <div class="tab-pane fade" id="tasks" role="tabpanel">
                    <div class="mt-3" id="taskProgressContent">
                        <!-- Task progress will be displayed here -->
                    </div>
                </div>

                <!-- Rankings & Scores -->
                <div class="tab-pane fade" id="rankings" role="tabpanel">
                    <div class="mt-3">
                        <div class="row">
                            <div class="col-md-8">
                                <canvas id="scoreChart"></canvas>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Final Rankings</h5>
                                    </div>
                                    <div class="card-body" id="finalRankings">
                                        <!-- Final rankings will be displayed here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Strategic Analysis -->
                <div class="tab-pane fade" id="analysis" role="tabpanel">
                    <div class="mt-3" id="analysisContent">
                        <!-- Strategic analysis will be displayed here -->
                    </div>
                </div>

                <!-- Quantitative Analysis -->
                <div class="tab-pane fade" id="quantitative" role="tabpanel">
                    <div class="mt-3">
                        <!-- Performance Metrics -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Performance Metrics</h4>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title">Total Tasks</h5>
                                        <h2 class="text-primary" id="totalTasks">-</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title">Total Points</h5>
                                        <h2 class="text-success" id="totalPoints">-</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title">Avg Points/Task</h5>
                                        <h2 class="text-info" id="avgPointsPerTask">-</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h5 class="card-title">First Completion Rate</h5>
                                        <h2 class="text-warning" id="firstCompletionRate">-</h2>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Agent Performance Table -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Agent Performance Breakdown</h4>
                                <div class="table-responsive">
                                    <table class="table table-striped" id="agentPerformanceTable">
                                        <thead>
                                            <tr>
                                                <th>Agent</th>
                                                <th>Tasks <i class="bi bi-info-circle-fill metric-info" data-bs-toggle="tooltip" title="Total number of tasks completed successfully"></i></th>
                                                <th>Points <i class="bi bi-info-circle-fill metric-info" data-bs-toggle="tooltip" title="Total points earned from completed tasks"></i></th>
                                                <th>Avg/Task <i class="bi bi-info-circle-fill metric-info" data-bs-toggle="tooltip" title="Average points earned per completed task"></i></th>
                                                <th>First Completions <i class="bi bi-info-circle-fill metric-info" data-bs-toggle="tooltip" title="Number of tasks completed first (earning bonus points)"></i></th>
                                                <th>Messages Sent <i class="bi bi-info-circle-fill metric-info" data-bs-toggle="tooltip" title="Total messages sent to other agents"></i></th>
                                                <th>Info Shared <i class="bi bi-info-circle-fill metric-info" data-bs-toggle="tooltip" title="Total information pieces shared with others"></i></th>
                                                <th>Response Rate <i class="bi bi-info-circle-fill metric-info" data-bs-toggle="tooltip" title="Percentage of information requests that were answered"></i></th>
                                            </tr>
                                        </thead>
                                        <tbody id="agentPerformanceBody">
                                            <!-- Rows will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Communication Metrics -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Communication Analysis</h4>
                            </div>
                            <div class="col-md-6">
                                <canvas id="communicationChart"></canvas>
                            </div>
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5>Communication Summary</h5>
                                        <ul class="list-unstyled" id="commSummary">
                                            <!-- Summary will be populated here -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Message Content Analysis -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Message Content Analysis</h4>
                                <p class="text-muted">Analysis of message patterns to identify strategic behaviors</p>
                            </div>
                            <div class="col-md-6">
                                <canvas id="messagePatternChart"></canvas>
                            </div>
                            <div class="col-md-6">
                                <div id="deceptionAnalysis">
                                    <!-- Deception analysis will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Communication Effectiveness Analysis -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Communication Effectiveness</h4>
                                <p class="text-muted">Correlation between messages sent and information received</p>
                            </div>
                            <div class="col-12">
                                <div id="communicationEffectiveness">
                                    <!-- Communication effectiveness analysis will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Strategic Reports -->
                <div class="tab-pane fade" id="reports" role="tabpanel">
                    <div class="mt-3">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>Select Agent</h5>
                                    </div>
                                    <div class="card-body">
                                        <select id="reportAgentSelect" class="form-select mb-3">
                                            <option value="">Select an agent...</option>
                                        </select>
                                        <div id="reportAgentInfo" class="mt-3">
                                            <!-- Agent summary will be displayed here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div id="strategicReportsContent">
                                    <p class="text-muted">Select an agent to view their strategic reports throughout the simulation.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cooperation Analysis -->
                <div class="tab-pane fade" id="cooperation" role="tabpanel">
                    <div class="mt-3">
                        <!-- Metric Explanations -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <div class="metric-explanation">
                                    <h6><i class="bi bi-info-circle"></i> Understanding Cooperation Metrics</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>Hoarding Rate:</strong> Measures how selfish an agent is with information. Calculated as: (requests received - info shared) / requests received. A rate of 0% means they share everything requested, 100% means they share nothing.</p>
                                            <p><strong>Cooperation Scores:</strong> Subjective ratings (1-10) that agents give each other based on perceived helpfulness. These may not reflect actual behavior.</p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Response Rate:</strong> Percentage of information requests that were answered. High response rate indicates reliability.</p>
                                            <p><strong>Strategic Misperception:</strong> When an agent's cooperation score doesn't match their actual sharing behavior, they're either overrated (false cooperators) or underrated (undervalued cooperators).</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Insights Overview -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Key Cooperation Insights</h4>
                                <div id="cooperationInsights" class="alert alert-info">
                                    <!-- Insights will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Cooperation Correlations -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Cooperation Score Correlations</h4>
                                <p class="text-muted">How cooperation perception correlates with actual behavior and performance</p>
                            </div>
                            <div class="col-md-6">
                                <canvas id="cooperationPerformanceChart"></canvas>
                            </div>
                            <div class="col-md-6">
                                <canvas id="perceptionRealityChart"></canvas>
                            </div>
                        </div>

                        <!-- Strategic Misperception -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Strategic Misperception Analysis</h4>
                                <p class="text-muted">Agents whose perceived cooperation doesn't match their actual behavior</p>
                            </div>
                            <div class="col-md-6">
                                <div id="falseCooperators">
                                    <!-- False cooperators will be listed here -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div id="undervaluedCooperators">
                                    <!-- Undervalued cooperators will be listed here -->
                                </div>
                            </div>
                        </div>

                        <!-- Cooperation Networks -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Cooperation Networks & Cliques</h4>
                                <p class="text-muted">Groups of agents with mutual high cooperation ratings</p>
                            </div>
                            <div class="col-md-8">
                                <canvas id="cooperationNetworkViz"></canvas>
                            </div>
                            <div class="col-md-4">
                                <div id="networkPerformance">
                                    <!-- Network performance stats will be shown here -->
                                </div>
                            </div>
                        </div>

                        <!-- Reciprocity Analysis -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Reciprocity Patterns</h4>
                                <p class="text-muted">Analysis of mutual cooperation and its impact on performance</p>
                            </div>
                            <div class="col-12">
                                <div id="reciprocityAnalysis">
                                    <!-- Reciprocity analysis will be shown here -->
                                </div>
                            </div>
                        </div>

                        <!-- Agent Performance vs Cooperation -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Agent Performance & Cooperation Breakdown</h4>
                                <div class="table-responsive">
                                    <table class="table table-striped" id="cooperationPerformanceTable">
                                        <thead>
                                            <tr>
                                                <th>Agent</th>
                                                <th>Final Rank</th>
                                                <th>Total Points</th>
                                                <th>Avg Coop Given <i class="bi bi-info-circle-fill metric-info" data-bs-toggle="tooltip" title="Average cooperation score this agent gave to others (1-10 scale)"></i></th>
                                                <th>Avg Coop Received <i class="bi bi-info-circle-fill metric-info" data-bs-toggle="tooltip" title="Average cooperation score others gave to this agent (1-10 scale)"></i></th>
                                                <th>Info Shared <i class="bi bi-info-circle-fill metric-info" data-bs-toggle="tooltip" title="Total number of information pieces shared with other agents"></i></th>
                                                <th>Hoarding Rate <i class="bi bi-info-circle-fill metric-info" data-bs-toggle="tooltip" title="Percentage of requested information that was NOT shared. Formula: (requests received - info shared) / requests received"></i></th>
                                            </tr>
                                        </thead>
                                        <tbody id="cooperationPerformanceBody">
                                            <!-- Rows will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Temporal Cooperation Evolution -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Cooperation Evolution Over Time</h4>
                                <p class="text-muted">How cooperation patterns change throughout the simulation</p>
                            </div>
                            <div class="col-md-8">
                                <canvas id="temporalCooperationChart"></canvas>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6>Key Events</h6>
                                    </div>
                                    <div class="card-body" id="cooperationEvents">
                                        <!-- Alliance formations and betrayals will be listed here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Information Value Analysis -->
                <div class="tab-pane fade" id="information" role="tabpanel">
                    <div class="mt-3">
                        <!-- Information Value Overview -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Information Value Analysis</h4>
                                <p class="text-muted">Understanding which information pieces drive the most value and how timing affects strategy</p>
                            </div>
                        </div>
                        
                        <!-- High Value Information -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h5>High-Value Information Pieces</h5>
                                    </div>
                                    <div class="card-body" id="highValueInfo">
                                        <!-- High value info will be listed here -->
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <canvas id="infoValueChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Timing Strategies -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Information Sharing Timing Strategies</h4>
                            </div>
                            <div class="col-md-8">
                                <canvas id="timingStrategyChart"></canvas>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h6>First Mover Advantage</h6>
                                    </div>
                                    <div class="card-body" id="firstMoverAnalysis">
                                        <!-- First mover analysis will be shown here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Information Hoarding Patterns -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Strategic Information Management</h4>
                                <p class="text-muted">How agents strategically share or withhold high-value information</p>
                            </div>
                            <div class="col-12">
                                <div id="infoManagementAnalysis">
                                    <!-- Strategic info management analysis will be shown here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>